---
title: "Report: Hybrid vigor in response to Eimeria in the HMHZ"
author: "Alice"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document:
    toc: yes
    toc_depth: '4'
    fig_caption: yes        
    includes:  
      in_header: preamble-latex.tex
  word_document:
    toc: yes
    toc_depth: 4
    fig_caption: yes        
    includes:  
      in_header: preamble-latex.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("../R/Data_Preparation_Alice.R")
```

# To be fixed before all

* Some information regarding latitude and longitude are missing for the following mice:

`r latLongMissing`

* We still miss info (HI) on the following mice (ask Jarda):

`r miceInfoNeeded` 

# General informations on HMHZ

```{r map, echo=FALSE, warning=FALSE, fig.width = 6, fig.height = 4, fig.cap="\\label{fig:map} Map of the mice with OPG, PCR or qPCR status, caught in the Brandenburg-MVP transect in 2015, 2016 and 2017. Each point corresponds to one location, a less pronounced transparency indicating more animals sampled at this location. Hybrid index is represented by a gradient from blue (M.m.d) to red (M.m.m)"}
mapHMHZ
```

* `r Nmice` mice were captured over three years, from `r Nfarm` farms

* From these mice:

* `r noo` mice had Eimeria detected by feces flotation,
* `r npcr` mice had Eimeria detected by colon content PCR (cf paper Victor),
* `r nqPCR` mice had Eimeria detected by qPCR on intestinal tissues

* On average, `r round(MEAN,2)` mice were caught per farm (95% CI `r round(CI,2)`)

* **Hybrid indexes** were calculated as ratio of M.m.d/M.m.m alleles (between `r minHINloci` and `r maxHINloci`, on average `r meanHINloci` loci)

```{r plotDensHI, echo=FALSE, warning=FALSE, fig.width=5,fig.height=3,fig.cap="\\label{fig:plot1}Number of animals caught along the hybrid index "}
plotDensHI <- ggplot(myData, aes(x = HI)) +
  geom_histogram(binwidth = 0.05, col = "black", fill = "lightblue") +
  theme_bw()
plotDensHI
```

# Comparison of prevalences based on detection method

```{r tabPrevOO, echo=FALSE, results='asis'}
library(knitr)
kable(prevalenceFlotation, caption = "Prevalence of Eimeria per year, based on oocyst flotation")
```

```{r tabPrevPCR, echo=FALSE, results='asis'}
library(knitr)
kable(prevalencePCR, caption = "Prevalence of Eimeria per year, based on PCR detection. A mouse was considered infected by Eimeria ifone of the 3 markers (COI, 18S or ORF470) gave a sequence")
```

```{r tabPrevqPCR, echo=FALSE, results='asis'}
library(knitr)
kable(prevalenceqPCR, caption = "Prevalence of Eimeria per year, based on qPCR")
```

```{r tabPrevtot, echo=FALSE, results='asis'}
library(knitr)
kable(prevalenceTot, caption = "Prevalence of Eimeria per year, based on all detections methods. A mouse was considered infected by Eimeria if one of the 3 markers (COI, 18S or ORF470) gave a sequence, OR if it had a positive count of oocysts in its feces, OR if it was qPCR positive")
```

## Improving Eimeria oocysts detection

`r N1` new samples were detected while diluting by 0.1mL PBS instead of 1mL before counting in Neubauer chamber.

Adjusted R-squared = `r round(adjrsq, 2)` represents the amount of variation in y explained by x. 

*https://www.r-bloggers.com/correlation-and-linear-regression/ (for Lorenzo)*

```{r plot1, echo=FALSE, warning=FALSE,  fig.width=5,fig.height=3,fig.cap="\\label{fig:plot1}Comparison of OPG depending on dilution level. Red line represents linear relationship between both axis, dotted line represents the function y = x"}
plot1
```

## Comparison oocysts flotation, PCR, qPCR 

```{r venn1, echo=FALSE, warning=FALSE, message=FALSE, fig.width=5,fig.height=3,fig.cap="\\label{fig:venn1}Comparison of detection: PCR vs flotation"}
myVennDiagram2(completeData1)
```

```{r compOPGqPCR, echo=FALSE, warning=FALSE, message=FALSE, fig.width=5,fig.height=3,fig.cap="\\label{fig:venn1}Comparison of positive values of OPG and qPCR for year 2016"}
plotcompOPGqPCR
```


```{r venn2, echo=FALSE, warning=FALSE, message=FALSE, fig.width=5,fig.height=3,fig.cap="\\label{fig:venn1}Comparison of detection: PCR vs flotation vs qPCŔ"}
myVennDiagram3(completeData)
```


# Testing hybrid vigor along HMHZ

## Oocyst shedding proxy

First approximation:

```{r plotSmoothOPG, echo=FALSE, warning=FALSE, fig.width=6, fig.height=4, fig.cap="\\label{fig:plotSmoothOPG}OPG along HI, colored per year. Blue line represent a smooth function (method = loess)"}
plotSmoothOPG
```

Statistical model (dvp...)

## qPCR proxy

tbc

## BCI proxy

First approximation:

```{r plotBCI, echo=FALSE, warning=FALSE, fig.width=6, fig.height=4, fig.cap="\\label{fig:plotSmoothOPG}BCI along HI, colored per level of OPG"}
plotBCI
```

# Bonus part: genotyping of mice case/control

* `r N_OPGPositive` out of `r totalOPG` are positive for flotation and have an hybrid index.

* `r N_qPCRPositive` out of `r totalqPCR` are positive for qPCR and have an hybrid index.

* `r N_QuantitativePositive` out of `r totalQuantitative` are positive for either flotation or qPCR, and have an hybrid index.

Discussed with Stuart:

* Test distributions 0 or counts. Test all vs only infected ("intensity") distribution. We should be able to fit the distribution of infected on all. Zeros are data. Stochastic move.
* Separation of the zero class. balanced design case/control ~ 400 +/-70infectés SNPchip. 
* H0: no differences are observed
* Separate <0.5 and >0.5 to see the species effect
- timing : WHEN (for my thesis?)


